#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è”¡é‡‘èµ„é‡‘æµé‡ç­–ç•¥ (Chaikin Money Flow, CMF)
==========================================

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å…³äº TqSdk â€”â€” å¤©å‹¤é‡åŒ–å¼€å‘åŒ…ã€‘

TqSdk æ˜¯ç”±ä¿¡æ˜“ç§‘æŠ€å‘èµ·å¹¶å¼€æºçš„ Python é‡åŒ–äº¤æ˜“æ¡†æ¶ï¼Œä¸“ä¸ºå›½å†…æœŸè´§å¸‚åœºè®¾è®¡ï¼Œ
æ˜¯å›½å†…æœ€ä¸»æµçš„æœŸè´§é‡åŒ–å¼€å‘å·¥å…·ä¹‹ä¸€ã€‚

æ ¸å¿ƒä¼˜åŠ¿ï¼š
  â— æç®€ä»£ç ï¼šå‡ åè¡Œå³å¯æ„å»ºå®Œæ•´ç­–ç•¥ï¼Œå†…ç½® MA/MACD/BOLL/RSI/ATR ç­‰è¿‘ç™¾ä¸ªæŠ€æœ¯æŒ‡æ ‡
  â— å…¨å“ç§å®æ—¶è¡Œæƒ…ï¼šæœŸè´§ã€æœŸæƒã€è‚¡ç¥¨ï¼Œæ¯«ç§’çº§æ¨é€ï¼Œæ•°æ®å…¨åœ¨å†…å­˜ï¼Œé›¶å»¶è¿Ÿ
  â— å…¨æµç¨‹æ”¯æŒï¼šå†å²å›æµ‹ â†’ æ¨¡æ‹Ÿäº¤æ˜“ â†’ å®ç›˜äº¤æ˜“ â†’ è¿è¡Œç›‘æ§ï¼Œä¸€å¥— API å…¨è¦†ç›–
  â— å¹¿æ³›å…¼å®¹ï¼šæ”¯æŒ 90%+ æœŸè´§å…¬å¸ CTP ç›´è¿åŠä¸»æµèµ„ç®¡æŸœå°
  â— Pandas å‹å¥½ï¼šK çº¿ / Tick æ•°æ®ç›´æ¥è¿”å› DataFrameï¼Œä¸ NumPy æ— ç¼é…åˆ

å®˜æ–¹èµ„æºï¼š
  ğŸ“˜ å®˜æ–¹æ–‡æ¡£ï¼šhttps://doc.shinnytech.com/tqsdk/latest/
  ğŸ™ GitHub  ï¼šhttps://github.com/shinnytech/tqsdk-python
  ğŸ§‘â€ğŸ’» è´¦æˆ·æ³¨å†Œï¼šhttps://account.shinnytech.com/
  ğŸ’¬ ç”¨æˆ·ç¤¾åŒºï¼šhttps://www.shinnytech.com/qa/

å®‰è£…ï¼špip install tqsdk -U
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ç­–ç•¥èƒŒæ™¯ä¸æ¥æºã€‘
è”¡é‡‘èµ„é‡‘æµé‡ï¼ˆCMFï¼‰æŒ‡æ ‡ç”±è‘—åæŠ€æœ¯åˆ†æå¸ˆ Marc Chaikin åœ¨ 20 ä¸–çºª 80 å¹´ä»£å‘æ˜ã€‚
Chaikin å°†å…¶èŒä¸šç”Ÿæ¶¯å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨ç ”ç©¶"èµ„é‡‘æµå‘"ä¸ä»·æ ¼çš„å…³ç³»ä¸Šï¼Œä»–è®¤ä¸ºæœºæ„å¤§èµ„é‡‘
çš„ä¹°å–è¡Œä¸ºä¼šåœ¨ K çº¿å½¢æ€ä¸æˆäº¤é‡ä¸­ç•™ä¸‹ç—•è¿¹ã€‚CMF æ­£æ˜¯å¯¹è¿™ä¸€æ€æƒ³çš„é‡åŒ–ä½“ç°ï¼šé€šè¿‡
æ¯æ ¹Kçº¿æ”¶ç›˜åœ¨é«˜ä½ä»·åŒºé—´ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œç»“åˆå½“æ ¹çš„æˆäº¤é‡åŠ æƒï¼Œè¡¡é‡ä¸€æ®µæ—¶é—´å†…
"ä¹°æ–¹åŠ›é‡"ä¸"å–æ–¹åŠ›é‡"çš„å‡€å€¼ã€‚

CMF çš„æ ¸å¿ƒæ€è·¯æ¥æºäºä¸¤ä¸ªç»å…¸è§‚å¯Ÿï¼š
1. **æ”¶ç›˜ä»·è¶Šé è¿‘é«˜ç‚¹ï¼Œè¯´æ˜å¤šæ–¹åŠ›é‡è¶Šå¼ºï¼Œä¹°ç›˜èµ„é‡‘æµå…¥è¶Šå……åˆ†**ï¼›
   åä¹‹ï¼Œæ”¶ç›˜è¶Šé è¿‘ä½ç‚¹ï¼Œåˆ™ç©ºæ–¹èµ„é‡‘ä¸»å¯¼ã€‚
2. **æˆäº¤é‡æ˜¯åŠ›é‡çš„é‡åŒ–æ”¾å¤§å™¨**ï¼šç›¸åŒçš„ä»·æ ¼ä½ç½®ï¼Œæˆäº¤é‡è¶Šå¤§ï¼Œä»£è¡¨å½“æ—¥èµ„é‡‘è¡Œä¸ºè¶Š
   åšå†³ï¼Œå¯¹åå¸‚èµ°åŠ¿çš„æŒ‡ç¤ºæ„ä¹‰è¶Šå¼ºã€‚

å°†ä»¥ä¸Šä¸¤ç‚¹ç»“åˆï¼ŒCMF åœ¨å›½é™…è‚¡å¸‚ä¸æœŸè´§å¸‚åœºå‡è¢«å¹¿æ³›è¿ç”¨ï¼Œå°¤å…¶é€‚åˆè¶‹åŠ¿è¿‡æ»¤ä¸
é‡ä»·èƒŒç¦»çš„åˆ¤æ–­ã€‚

ã€æ ¸å¿ƒå…¬å¼æ¨å¯¼ã€‘

Step 1ï¼šè®¡ç®—æ¯æ ¹Kçº¿çš„"èµ„é‡‘æµé‡ä¹˜æ•°"ï¼ˆMoney Flow Multiplier, MFMï¼‰
  MFM = [(Close - Low) - (High - Close)] / (High - Low)
      = [2 Ã— Close - High - Low] / (High - Low)

  è§£é‡Šï¼š
  - åˆ†å­ = æ”¶ç›˜ä»·åœ¨é«˜ä½èŒƒå›´ä¸­çš„ä½ç½®åç§»ï¼ˆæ­£å€¼â†’é è¿‘é«˜ç‚¹â†’ä¹°æ–¹å¼ºåŠ¿ï¼›è´Ÿå€¼â†’é è¿‘ä½ç‚¹â†’å–æ–¹å¼ºåŠ¿ï¼‰
  - åˆ†æ¯ = å½“æ ¹Kçº¿çš„æ€»æŒ¯å¹…ï¼ˆå½’ä¸€åŒ–å¤„ç†ï¼‰
  - MFM èŒƒå›´ï¼š[-1, +1]ï¼Œå®Œå…¨æ”¶æœ€é«˜ç‚¹æ—¶=+1ï¼Œå®Œå…¨æ”¶æœ€ä½ç‚¹æ—¶=-1

Step 2ï¼šè®¡ç®—"èµ„é‡‘æµé‡æˆäº¤é‡"ï¼ˆMoney Flow Volume, MFVï¼‰
  MFV = MFM Ã— Volume

  è§£é‡Šï¼šç”¨æˆäº¤é‡å¯¹ MFM è¿›è¡ŒåŠ æƒï¼Œæ”¾å¤§é«˜æˆäº¤é‡æ—¥çš„èµ„é‡‘æµå‘ä¿¡å·

Step 3ï¼šè®¡ç®— CMFï¼ˆNæ—¥æ»šåŠ¨å¹³å‡ï¼‰
  CMF(N) = Sum(MFV, N) / Sum(Volume, N)

  è§£é‡Šï¼šN æ—¥å†…èµ„é‡‘æµé‡æˆäº¤é‡çš„ç´¯åŠ ï¼Œå†é™¤ä»¥ N æ—¥æ€»æˆäº¤é‡ï¼Œå¾—åˆ°å½’ä¸€åŒ–çš„èµ„é‡‘æµé‡æŒ‡æ ‡
  CMF èŒƒå›´åŒæ ·åœ¨ [-1, +1] å†…ï¼Œå¸¸ç”¨ N = 20

ã€ä¿¡å·è§£è¯»ã€‘
  CMF > +0.05  : èµ„é‡‘æŒç»­å‡€æµå…¥ï¼Œå¤šæ–¹åŠ›é‡å ä¼˜ï¼Œåå¤š
  CMF < -0.05  : èµ„é‡‘æŒç»­å‡€æµå‡ºï¼Œç©ºæ–¹åŠ›é‡å ä¼˜ï¼Œåç©º
  -0.05 â‰¤ CMF â‰¤ +0.05 : ä¸­æ€§åŒºï¼Œèµ„é‡‘æ–¹å‘ä¸æ˜ï¼Œä¸æ“ä½œ

ã€äº¤æ˜“è§„åˆ™ã€‘
å…¥åœºï¼ˆä¿¡å·ç”±[-0.05, 0.05]ä¸­æ€§åŒºçªç ´è¿›å…¥å¼ºåŠ¿åŒºï¼‰ï¼š
  å¼€å¤š = CMF ç”± â‰¤0.05 ä¸Šç©¿ +0.05ï¼ˆèµ„é‡‘æµå…¥ç¡®è®¤ï¼Œè¶‹åŠ¿è½¬å¤šï¼‰
       â†’ target_pos.set_target_volume(+VOLUME)
  å¼€ç©º = CMF ç”± â‰¥-0.05 ä¸‹ç©¿ -0.05ï¼ˆèµ„é‡‘æµå‡ºç¡®è®¤ï¼Œè¶‹åŠ¿è½¬ç©ºï¼‰
       â†’ target_pos.set_target_volume(-VOLUME)

å‡ºåœºï¼ˆCMF ä¿¡å·åè½¬æˆ–å›å½’ä¸­æ€§ï¼‰ï¼š
  å¹³å¤š = CMF è·Œå› 0 ä»¥ä¸‹ï¼ˆèµ„é‡‘å‡€æµå…¥æ¶ˆå¤±ï¼‰â†’ set_target_volume(0)
  å¹³ç©º = CMF å‡å› 0 ä»¥ä¸Šï¼ˆèµ„é‡‘å‡€æµå‡ºæ¶ˆå¤±ï¼‰â†’ set_target_volume(0)

é™„åŠ è¿‡æ»¤ï¼š
  - å½“ High == Low æ—¶ï¼ˆä¸€å­—æ¶¨åœ/è·Œåœæ¿ï¼‰ï¼ŒMFM æ— æ³•è®¡ç®—ï¼ˆé™¤é›¶ï¼‰ï¼Œè·³è¿‡è¯¥æ ¹Kçº¿
  - ä½¿ç”¨ pandas çš„ rolling().sum() å®ç°çª—å£å†…ç´¯åŠ ï¼Œæ€§èƒ½é«˜æ•ˆ

ã€é‡ä»·èƒŒç¦»çš„é«˜é˜¶ç”¨æ³•ï¼ˆä»…è¯´æ˜ï¼Œä»£ç æœªå®ç°ï¼‰ã€‘
  CMF æŒ‡æ ‡æœ€ç»å…¸çš„é«˜é˜¶ç”¨æ³•æ˜¯"é‡ä»·èƒŒç¦»"ï¼š
  - ä»·æ ¼åˆ›æ–°é«˜ï¼Œä½† CMF æœªåˆ›æ–°é«˜ï¼ˆé¡¶èƒŒç¦»ï¼‰â†’ è¶‹åŠ¿å¯èƒ½è§é¡¶ï¼Œåšç©ºæœºä¼š
  - ä»·æ ¼åˆ›æ–°ä½ï¼Œä½† CMF æœªåˆ›æ–°ä½ï¼ˆåº•èƒŒç¦»ï¼‰â†’ è¶‹åŠ¿å¯èƒ½è§åº•ï¼Œåšå¤šæœºä¼š
  åœ¨å®ç›˜ä¸­ï¼Œç»“åˆèƒŒç¦»åˆ¤æ–­èƒ½æ˜¾è‘—æé«˜èƒœç‡ï¼Œä½†å®ç°è¾ƒå¤æ‚ï¼Œæœ¬ç­–ç•¥ä»¥ç®€æ´å¯è¿è¡Œä¸ºä¸»ã€‚

ã€é€‚ç”¨å“ç§å’Œå‘¨æœŸã€‘
å“ç§ï¼šæœ‰ç¨³å®šæˆäº¤é‡çš„ä¸»åŠ›åˆçº¦ï¼Œå¦‚æ²ªé“œï¼ˆCUï¼‰ã€è±†ç²•ï¼ˆMï¼‰ã€èºçº¹é’¢ï¼ˆRBï¼‰ã€é»„é‡‘ï¼ˆAUï¼‰
å‘¨æœŸï¼šæ—¥çº¿ï¼ˆ86400ç§’ï¼‰æˆ–å°æ—¶çº¿ï¼ˆ3600ç§’ï¼‰å‡å¯ï¼Œé»˜è®¤ä½¿ç”¨æ—¥çº¿
å‘¨æœŸé€‰æ‹©ï¼šæˆäº¤é‡æ•°æ®åœ¨æ—¥çº¿ä¸Šæ›´ç¨³å®šï¼Œå™ªéŸ³æ›´å°‘ï¼Œä¿¡å·è´¨é‡æ›´é«˜

ã€ä¼˜ç¼ºç‚¹åˆ†æã€‘
ä¼˜ç‚¹ï¼š
  - ç»“åˆä»·æ ¼ä½ç½®ä¸æˆäº¤é‡ï¼Œæ¯”å•çº¯ä»·æ ¼æŒ‡æ ‡æ›´ç«‹ä½“
  - å½’ä¸€åŒ–å¤„ç†åï¼Œä¸åŒå“ç§ã€ä¸åŒæ³¢åŠ¨ç‡ä¸‹é˜ˆå€¼ï¼ˆÂ±0.05ï¼‰ç›¸å¯¹é€šç”¨
  - è®¡ç®—ç®€å•ç›´è§‚ï¼Œé€»è¾‘é“¾æ¡æ¸…æ™°ï¼Œæ˜“äºç†è§£å’ŒéªŒè¯
  - å¯¹æœºæ„å¤§èµ„é‡‘çš„è¿›å‡ºè¡Œä¸ºæœ‰ä¸€å®šé¢„æµ‹èƒ½åŠ›

ç¼ºç‚¹ï¼š
  - åœ¨æˆäº¤é‡ä¸æ´»è·ƒçš„å“ç§æˆ–æ—¶æ®µï¼ˆå¤œç›˜æ¸…æ·¡æ—¶æ®µï¼‰ä¿¡å·å¯é æ€§é™ä½
  - CMF æœ¬èº«å­˜åœ¨ä¸€å®šæ»åæ€§ï¼ˆçª—å£æœŸ N è¶Šå¤§ï¼Œæ»åè¶Šæ˜æ˜¾ï¼‰
  - çº¯ç²¹çš„ CMF ä¿¡å·åœ¨éœ‡è¡å¸‚ä¸­å®¹æ˜“å‘å‡ºè¿ç»­å‡ä¿¡å·
  - ä¸å«æ­¢æŸæœºåˆ¶ï¼Œå»ºè®®ç»“åˆ ATR è¿½è¸ªæ­¢æŸä½¿ç”¨

ã€å‚æ•°è¯´æ˜ã€‘
  SYMBOL   : äº¤æ˜“åˆçº¦ä»£ç 
  CMF_N    : CMF è®¡ç®—çª—å£æœŸï¼Œé»˜è®¤ 20 æ ¹Kçº¿
  VOLUME   : æ¯æ¬¡å¼€ä»“æ‰‹æ•°
  BULL_TH  : CMF å¤šå¤´é˜ˆå€¼ï¼ˆä¸Šç©¿æ—¶åšå¤šï¼‰ï¼Œé»˜è®¤ +0.05
  BEAR_TH  : CMF ç©ºå¤´é˜ˆå€¼ï¼ˆä¸‹ç©¿æ—¶åšç©ºï¼‰ï¼Œé»˜è®¤ -0.05
"""

from tqsdk import TqApi, TqAuth, TqSim, TargetPosTask
import pandas as pd

# ===================== ç­–ç•¥å‚æ•° =====================
SYMBOL  = "SHFE.cu2506"    # äº¤æ˜“åˆçº¦ï¼šæ²ªé“œ2506
CMF_N   = 20               # CMF è®¡ç®—çª—å£æœŸï¼ˆæ—¥çº¿æ ¹æ•°ï¼‰
VOLUME  = 1                # æ¯æ¬¡å¼€ä»“æ‰‹æ•°
BULL_TH = 0.05             # CMF å¤šå¤´é˜ˆå€¼ï¼ˆè¶…è¿‡æ­¤å€¼è§†ä¸ºèµ„é‡‘å‡€æµå…¥ï¼‰
BEAR_TH = -0.05            # CMF ç©ºå¤´é˜ˆå€¼ï¼ˆä½äºæ­¤å€¼è§†ä¸ºèµ„é‡‘å‡€æµå‡ºï¼‰
# ===================================================


def calc_cmf(klines: pd.DataFrame, n: int) -> pd.Series:
    """
    è®¡ç®—è”¡é‡‘èµ„é‡‘æµé‡æŒ‡æ ‡ï¼ˆChaikin Money Flowï¼‰

    å‚æ•°ï¼š
      klines : TqSdk è¿”å›çš„ K çº¿ DataFrameï¼ŒåŒ…å« high/low/close/volume åˆ—
      n      : æ»šåŠ¨çª—å£å¤§å°

    è¿”å›ï¼š
      cmf : pd.Seriesï¼Œä¸ klines ç­‰é•¿ï¼Œæœ€æ–°çš„å€¼åœ¨ iloc[-1]
    """
    high   = klines["high"]
    low    = klines["low"]
    close  = klines["close"]
    volume = klines["volume"]

    # é«˜ä½ä»·å·®ï¼ˆæŒ¯å¹…ï¼‰ï¼Œé¿å…é™¤é›¶
    hl_range = high - low
    hl_range = hl_range.replace(0, float("nan"))  # ä¸€å­—æ¿æ—¶ä¸º NaNï¼Œè·³è¿‡

    # èµ„é‡‘æµé‡ä¹˜æ•° MFM = (2*close - high - low) / (high - low)
    mfm = (2 * close - high - low) / hl_range

    # èµ„é‡‘æµé‡æˆäº¤é‡ MFV = MFM Ã— volume
    mfv = mfm * volume

    # CMF = rolling_sum(MFV, N) / rolling_sum(volume, N)
    cmf = mfv.rolling(n).sum() / volume.rolling(n).sum()

    return cmf


def main():
    api = TqApi(
        account=TqSim(),
        auth=TqAuth("YOUR_ACCOUNT", "YOUR_PASSWORD"),
    )

    # è®¢é˜…æ—¥çº¿Kçº¿ï¼Œæ•°æ®é•¿åº¦éœ€è¦†ç›– CMF è®¡ç®—æ‰€éœ€çš„çª—å£æœŸåŠ ä¸€å®šå†—ä½™
    klines = api.get_kline_serial(SYMBOL, 86400, data_length=CMF_N + 10)

    # åˆå§‹åŒ–ç›®æ ‡ä»“ä½ä»»åŠ¡ï¼ˆè‡ªåŠ¨å¤„ç†è¿½å•/æ’¤å•/éƒ¨åˆ†æˆäº¤ï¼‰
    target_pos = TargetPosTask(api, SYMBOL)

    # è®°å½•ä¸Šä¸€æ ¹Kçº¿ç»“æŸæ—¶çš„ CMF å€¼ï¼Œç”¨äºåˆ¤æ–­ç©¿è¶Š
    prev_cmf = None

    print(f"[CMFç­–ç•¥] å¯åŠ¨ | {SYMBOL} | CMFçª—å£={CMF_N} | é˜ˆå€¼={BEAR_TH}/{BULL_TH}")

    while True:
        api.wait_update()

        # åªåœ¨Kçº¿æ›´æ–°æ—¶ï¼ˆæ–°baräº§ç”Ÿï¼‰é‡æ–°è®¡ç®—ï¼Œé¿å…åœ¨barå†…éƒ¨é‡å¤è§¦å‘
        if not api.is_changing(klines):
            continue

        # è®¡ç®— CMF åºåˆ—
        cmf_series = calc_cmf(klines, CMF_N)

        # å–å€’æ•°ç¬¬äºŒæ ¹ï¼ˆå·²å®Œæˆçš„Kçº¿ï¼‰ï¼Œé¿å…ä½¿ç”¨æœªæ”¶ç›˜çš„æœ€æ–°bar
        current_cmf = cmf_series.iloc[-2]

        if pd.isna(current_cmf):
            # æ•°æ®ä¸è¶³ N æ ¹ï¼Œè·³è¿‡
            print(f"[CMFç­–ç•¥] æ•°æ®ä¸è¶³ï¼Œç­‰å¾…ç§¯ç´¯ä¸­ (CMF=NaN)")
            prev_cmf = current_cmf
            continue

        print(
            f"[CMFç­–ç•¥] CMF={current_cmf:.4f} | "
            f"å‰å€¼={prev_cmf:.4f if prev_cmf is not None and not pd.isna(prev_cmf) else 'N/A'} | "
            f"é˜ˆå€¼ [{BEAR_TH}, {BULL_TH}]"
        )

        if prev_cmf is not None and not pd.isna(prev_cmf):
            # ---- åšå¤šä¿¡å·ï¼šCMF ä¸Šç©¿ BULL_THï¼Œèµ„é‡‘å‡€æµå…¥ç¡®è®¤ ----
            if prev_cmf <= BULL_TH and current_cmf > BULL_TH:
                print(f">>> CMF ä¸Šç©¿ {BULL_TH}ï¼Œèµ„é‡‘å‡€æµå…¥ï¼å¼€å¤š")
                target_pos.set_target_volume(VOLUME)

            # ---- åšç©ºä¿¡å·ï¼šCMF ä¸‹ç©¿ BEAR_THï¼Œèµ„é‡‘å‡€æµå‡ºç¡®è®¤ ----
            elif prev_cmf >= BEAR_TH and current_cmf < BEAR_TH:
                print(f">>> CMF ä¸‹ç©¿ {BEAR_TH}ï¼Œèµ„é‡‘å‡€æµå‡ºï¼å¼€ç©º")
                target_pos.set_target_volume(-VOLUME)

            # ---- å¹³å¤šä¿¡å·ï¼šCMF è·Œå› 0 ä»¥ä¸‹ï¼ˆå¤šæ–¹èµ„é‡‘ä¼˜åŠ¿æ¶ˆå¤±ï¼‰----
            elif prev_cmf >= 0 and current_cmf < 0:
                print(">>> CMF è·Œç ´ 0ï¼Œå¤šæ–¹èµ„é‡‘ä¼˜åŠ¿æ¶ˆå¤±ï¼Œå¹³å¤š")
                target_pos.set_target_volume(0)

            # ---- å¹³ç©ºä¿¡å·ï¼šCMF å‡å› 0 ä»¥ä¸Šï¼ˆç©ºæ–¹èµ„é‡‘ä¼˜åŠ¿æ¶ˆå¤±ï¼‰----
            elif prev_cmf <= 0 and current_cmf > 0:
                print(">>> CMF å‡ç ´ 0ï¼Œç©ºæ–¹èµ„é‡‘ä¼˜åŠ¿æ¶ˆå¤±ï¼Œå¹³ç©º")
                target_pos.set_target_volume(0)

        # æ›´æ–° prev_cmfï¼Œè®°å½•æœ¬æ ¹Kçº¿çš„CMFå€¼ï¼Œä¾›ä¸‹ä¸€æ ¹Kçº¿æ¯”è¾ƒ
        prev_cmf = current_cmf

    api.close()


if __name__ == "__main__":
    main()
